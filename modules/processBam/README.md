# processBam Module (Multi-Snakemake)
This directory contains the ReBam module. It is a multi-module system and contains 
four modules which are heavily correlated. 

## Modules:
See invidual files for expanded explanations of their purpose and the manner in which they accomplish it.
* alignBAM_bwa: Conversion of a '.Fastq file to a '.BAM' file.
* bam2fastq: Conversion of a '.BAM' file to a '.Fastq' file.
* cleanBAM: Cleans the provided SAM/BAM, soft-clipping beyond-end-of-reference alignments and setting MAPQ to 0 for unmapped reads.
* fastqc: Run Fastqc on '.BAM' files.
* fastq2GZ: Compress a '.fastq' file into a '.fastq.gz' file.
* filteredBAM: Filtering of a '.BAM' file on read quality.
* fixmateBAM: Fill in mate coordinates, ISIZE, and mate related flags from a name-sorted alignment.
* indexBAM: Indexing of a '.BAM' file.
* markdupBAM: Mark diplicates in a '.BAM' file and produce metrics.
* namesortBAM: Produce a name sorted '.BAM' file. 
* rmdupBAM: Remove duplicates from a '.BAM' file.
* sortBAM_biobambam: Sorting of a '.BAM' file, via BIOBAMBAM.
* sortBAM_samtools: Sorting of a '.BAM' file, via SAMTOOLS.
*  **processBam** **processBam: Master file which includes the four modules above.**

## Control Flags
At times, there will need to exist submodules which only differ by the software they use and
the arguemnts that the respective software requires. To combined this into a single rule is possible
but, for the sake of simplicity and maximum cohesion, they have been seperated into different files.
As these two or more files will all produce the same output, Snakemake cannot otherwise make a choice
as to which of the options it must use. In this case, the following submodules exist with software 
variants. In order to override the default submodule software, users must set the following flags in 
the processBam section of the config.yaml file. If/elif/else conditionals were used, as such, the 
value flagged as "default" can be assumed to be contained within the else conditional.

Yaml Flag | Modules | How to Set
:--------: | :--------: | :--------
sortBamSoftwareChoiceFlag | sortBAM_biobambam | Default
sortBamSoftwareChoiceFlag | sortBAM_samtools | samtools
alignBamSoftwareChoiceFlag | alignBAM_bwa | Default

## Logging:
Will be stored in: "log/processBam"

## Global Directories:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | outputDIR | output | Directory to contain all file generated by the pipeline.
alignBAM, bam2fastq | inputDIR | Directory to contain all files prior to starting pipeline.
alignBAM | refDIR | ref |  Directory to contain the reference genome file.
indexBAM | bamDIR | bam | Directory to conatin the symlinked and name-normalized '.BAM' and '.BAI' files. 
markdup | metricsDIR | metrics | Directory to contain the processed '.metrics' files.
bam2fastq | inputDIR | input | Parent-directory to contain the unprocessed '.BAM' files.

## Global Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | shellCallFile | shellCalls.txt | File to which a copy of all shell calls is printed.
alignBAM | fastqKEEP | False | Flag of 'True' or 'False' on retaining '.fastq' files after they are used in the pipeline.
alignBAM | refFILE | GRCh37-lite.fa | Name of the reference genome file. 

## Module Specific Software:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
alignBAM, indexBAM, filteredBAM, namesortBAM, rmdupBAM, sortBAM, bam2fastq | processBam_samtoolsProg | samtools | Path to Samtools executable.
cleanBAM, fixmateBAM, bam2fastq | processBam_picardProg | picard | Path to Picard executable.
alignBAM | processBam_bwaProg | bwa | Path to bwa executable.
fastqc | processBam_perlProg | perl | Path to perl executable.
namesortBAM, sortBAM | processBam_bamsortProg| bamsort | Path to bamsort executable.
processBam_bammarkduplicates2Prog | bammarkduplicates2 | Path to bammarkduplicates2 executable.

## Module Specific Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | processBamDIR | processBam | Directory to contain the processed '.BAM' files.
alignBAM, bam2fastq | fastqDIR | fastq | Directory to contain the processed '.fastq' files.
alignBAM | coreNumber | -t 4 | 
alignBAM | picardCompatibility | -M | 
alignBAM | seqPlatform | ILLUMINA | 
alignBAM | trimReadsFLAG | False | Flag the trimming of the Fastq files prior to input into BWA.
alignBAM | phred64 | -Q 33 | Read quality scoring, alternatively set to: "-Q 64"
alignBAM | firstBaseToKeep | '' | Set first base to be kept using: "-f N"
alignBAM | lastBaseToKeep | '' | Set last base to be kept using: "-l N"
fastqc | fastqc | ~/share/usr/fastqc-0.10.1/fastqc.pl | Perl Fastqc script to process a '.BAM' file.
fastqc | nogroup | '' | Groups fastqc output based on certian inputs, alternatively set to: "--no-group"
cleanBAM, fixmateBAM, bam2fastq | picardvalStringency | VALIDATION_STRINGENCY=LENIENT | Validation stringency for all SAM files read by this program.
cleanBAM, fixmateBAM, bam2fastq | picardMaxRec | MAX_RECORDS_IN_RAM=5000000 | Specify the number of records stored in RAM before spilling to disk.
filteredBAM | bitFLAG | 512 | Must pass QC threshold.
indexBAM | fileTAG | _realigned_sorted_filtered_markdup | Tag facilitates processBam module processing of the '.BAM' files in a specific order.
markdupBAM | compressLVL | level=-1 | Default @ -1 (zlib); Can go fast(1) or best(9) using gzip instead.
sortBAM | sortProgFLAG | biobambam | Flag to set whether Samtools(samtools) or Biobambam(biobambam) are used to sort.
bam2fastq | rawBamDIR | rawBam | Directory to contain the unprocessed '.BAM' files.
bam2fastq | samtoolsSortMem | 4000000000 | Samtools sort memory allocation of SAM file prior to conversion to ".fastq" format. ** MUST BE REPRESENTED AS AN INTEGER! (NOT 4GB) **
