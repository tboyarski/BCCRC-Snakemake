# bamGen Module (Multi-Snakemake)
This directory contains the bamGen module. It is a multi-module system.

## Modules:
See invidual files for expanded explanations of their purpose and the manner in which they accomplish it.
* alignBAM_bwa: Conversion of a '.fastq' file to a '.bam' file, via BWA-MEM.
* alignBAM_starAligner: Conversion of a '.fastq' file to a '.bam' file, via STAR.
* **bamGen: Master file which includes the modules above.**

## Regression Testing:
Most recently on: **June 30th, 2017**

**Directory Prefix = /genesis/extscratch/clc/projects/tboyarski/RegressionTest/3-bamGen**

Please refer the the contained "RegTestREADME" directory for more information about each of the following directories:

    1 =  1-alignBAM_bwa/
    2 =  2-alignBAM_star/
    3 =  3-alignBAM_bwa_trimReads/

Module | Directory Tested Within
:--------: | :--------:
alignBAM_bwa (default) | 1
alignBAM_star | 2
alignBAM_bwa (trimReadsFlag) | 3

## Logging:
Will be stored in: "log/bamGen"

## Control Flags
At times, there will need to exist submodules which only differ by the software they use and
the arguemnts that the respective software requires. To combined this into a single rule is possible
but, for the sake of simplicity and maximum cohesion, they have been seperated into different files.
As these two or more files will all produce the same output, Snakemake cannot otherwise make a choice
as to which of the options it must use. In this case, the following submodules exist with software 
variants. In order to override the default submodule software, users must set the following flags in 
the bamGen section of the config.yaml file. If/elif/else conditionals were used, as such, the 
value flagged as "default" can be assumed to be contained within the else conditional.

YAML Flag | SubModules | Value required to set
:--------: | :--------: | :--------
SoftwareChoiceFlag_alignBAM | alignBAM_bwa | bwa
SoftwareChoiceFlag_alignBAM | alignBAM_star | STAR

## Global Directories:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | outputDIR | output | Directory to contain all file generated by the pipeline.
All | bamDIR | bam | Directory to contain the processed '.bam' files.
All | fastqDIR | fastq | Directory to contain the processed '.fastq' files.

## Global Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | shellCallFile | shellCalls.txt | File to which a copy of all shell calls is printed.
All | offCluster | False | Adds input redirection to end of shell calls as to capture STDERR when not on cluster.
All | intermediateKEEP | False | Remove intermediate files which are not likely to be used after intial processing.
All | fastqKEEP | False | Flag of 'True' or 'False' on retaining '.fastq' files after they are used in the pipeline.
All | refFILE | ../path/to/GRCh37-lite.fa | Absolute path to genomic reference file.

## Module Specific Software:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | bamGen_samtoolsProg | samtools | Program path.
bamALIGN_bwa | bamGen_bwaProg | bwa | Program path.
bamALIGN_bwa | bamGen_fastxProg | /genesis/extscratch/clc/usr/fastx_toolkit-0.0.13.2/bin/fastx_trimmer | Program path.
bamALIGN_star | bamGen_starProg | STAR | Program path.


## Module Specific Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | bamGenDIR | bamGen | Directory to contain the log files.
alignBAM_bwa | coreNumber | -t 4 | Number of threads.
alignBAM_bwa | picardCompatibility | -M | Mark shorter split hits as secondary (for Picard/GATK compatibility)
alignBAM_bwa | seqPlatform | ILLUMINA | Listed in header information.
alignBAM_bwa | trimReadsFLAG | False | Flag the trimming of the Fastq files prior to input into BWA.
alignBAM_bwa | phred64 | -Q 33 | Read quality scoring, alternatively set to: "-Q 64"
alignBAM_bwa | firstBaseToKeep | -f 1 | Set first base to be kept using: "-f N"
alignBAM_bwa | lastBaseToKeep | -l 1 | Set last base to be kept using: "-l N"
alignBAM_star | outputSuffixLIST_star | ['_Aligned.out.bam', '_Chimeric.out.junction', '_Chimeric.out.sam', '_Log.final.out', '_Log.out', '_Log.progress.out', '_ReadsPerGene.out.tab','_SJ.out.tab'] | List of output files not required in additional pipeline steps.
alignBAM_star | starRefGenomeDIR | /genesis/extscratch/clc/references/star/GRCh37/ref_genome.fa.star.idx | 
alignBAM_star | runThreadN | --runThreadN 4 | 
alignBAM_star | readFilesCommand | --readFilesCommand zcat | 
alignBAM_star | outSAMtype | --outSAMtype BAM Unsorted | 
alignBAM_star | outSAMunmapped | --outSAMunmapped Within KeepPairs | 
alignBAM_star | quantMode | --quantMode GeneCounts | 
alignBAM_star | sjdbGTFfile |  /genesis/extscratch/clc/references/star/hg19/gencode.v19.annotation.gtf | 
alignBAM_star | chimSegmentMin | --chimSegmentMin 15 | 
alignBAM_star | outSAMstrandField | --outSAMstrandField intronMotif | 
