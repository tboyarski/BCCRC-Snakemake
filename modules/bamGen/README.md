# bamGen Module

##  Logging:
Will be stored in: "log/bamGen"

## Modules:
See invidual files for expanded explanations of their purpose and the manner in which they accomplish it.
* bamALIGN_bwa: Conversion of a '.fastq' file to a '.bam' file, via BWA-MEM.
* bamALIGN_star: Conversion of a '.fastq' file to a '.bam' file, via STAR.
* sam2BAM: Conversion of a '.sam' file to a '.sam' file, via samtools.
* **bamGen_INCLUDE: Master file which includes the modules above.**

## Control Flags:
At times, there will need to exist submodules which only differ by the software they use and
the arguemnts that the respective software requires. To combined this into a single rule is possible
but, for the sake of simplicity and maximum cohesion, they have been seperated into different files.
As these two or more files will all produce the same output, Snakemake cannot otherwise make a choice
as to which of the options it must use. In this case, the following submodules exist with software 
variants. In order to override the default submodule software, users must set the following flags in 
the bamGen section of the config.yaml file. If/elif/else conditionals were used, as such, the 
value flagged as "default" can be assumed to be contained within the else conditional.

YAML Flag | SubModules | Value required to set
:--------: | :--------: | :--------
SoftwareChoiceFlag_bamALIGN | bamALIGN_bwa | bwa
SoftwareChoiceFlag_bamALIGN | bamALIGN_star | STAR

## Global Directories:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | bamDIR | bam | Directory to conatin the processed, symlinked, and name-normalized '.bam' and '.BAI' files.
None | inputDIR | input | Directory to contain all files prior to starting pipeline (Reference and input files).
bamALIGN_* | fastqDIR | fastq | Directory to contain the processed '.fastq' files.
None | metricsDIR | metrics | Directory to contain the processed '.metrics' files.
None | mpileupDIR | mpileup | Directory to contain the processed '.mpileup' files.
All | outputDIR | output | Directory to contain all files generated by the pipeline.

## Global Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | shellCallFile | shellCalls.txt | File to which a copy of all shell calls is printed.
All | offCluster | False | Adds input redirection to end of shell calls as to capture STDERR when not on cluster.
None | fastqKEEP | False | Flag of 'True' or 'False' on retaining '.fastq' files after they are used in the pipeline.
None | inputPartList | inputPartList.txt | List containing the parts which comprise each sample.
None | refFILE | *Varies* | Absolute path to genomic reference file.
None | supportRefFILE | *Varies* | Absolute path to supporting genomic references files.
None | chrLIST | *Varies* | Full chromosomal list parse from one of the supporting genomic reference files.

## Module Specific Software:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | bamGen_samtoolsProg | samtools | Program path.
bamALIGN_bwa | bamGen_bwaProg | bwa | Program path.
bamALIGN_bwa | bamGen_fastxProg | /genesis/extscratch/clc/usr/fastx_toolkit-0.0.13.2/bin/fastx_trimmer | Program path.
bamALIGN_star | bamGen_starProg | STAR | Program path.


## Module Specific Parameters:
Module | Argument | Default Value | Description
:--------: | :--------: | :--------: | :--------
All | bamGenDIR | bamGen | Directory to contain the log files.
bamALIGN_bwa | bwa_refFILE | *Varies* | Absolute path to genomic reference file.
bamALIGN_bwa | bwa_supportRefFILE | *Varies* | Absolute path to supporting genomic references files.
bamALIGN_bwa | coreNumber | -t 4 | Number of threads.
bamALIGN_bwa | picardCompatibility | -M | Mark shorter split hits as secondary (for Picard/GATK compatibility)
bamALIGN_bwa | seqPlatform | ILLUMINA | Listed in header information.
bamALIGN_bwa | trimReadsFLAG | False | Flag the trimming of the Fastq files prior to input into BWA.
bamALIGN_bwa | phred64 | -Q 33 | Read quality scoring, alternatively set to: "-Q 64"
bamALIGN_bwa | firstBaseToKeep | -f 1 | Set first base to be kept using: "-f N"
bamALIGN_bwa | lastBaseToKeep | -l 1 | Set last base to be kept using: "-l N"
bamALIGN_star | starRefGenomeDIR | /genesis/extscratch/clc/references/star/GRCh37/ref_genome.fa.star.idx | 
bamALIGN_star | runThreadN | --runThreadN 4 | 
bamALIGN_star | readFilesCommand | --readFilesCommand zcat | 
bamALIGN_star | outSAMtype | --outSAMtype BAM Unsorted | 
bamALIGN_star | outSAMunmapped | --outSAMunmapped Within KeepPairs | 
bamALIGN_star | quantMode | --quantMode GeneCounts | 
bamALIGN_star | sjdbGTFfile |  /genesis/extscratch/clc/references/star/hg19/gencode.v19.annotation.gtf | 
bamALIGN_star | chimSegmentMin | --chimSegmentMin 15 | 
bamALIGN_star | outSAMstrandField | --outSAMstrandField intronMotif | 
bamALIGN_star | outputSuffixLIST_star | ['_Aligned.out.bam', '_Chimeric.out.junction', '_Chimeric.out.sam', '_Log.final.out', '_Log.out', '_Log.progress.out', '_ReadsPerGene.out.tab','_SJ.out.tab'] | List of output files not required in additional pipeline steps.
sam2BAM | sam2BamARGS | '' | Arguments to provide sam2BAM. 
sam2BAM | samINDIR | sam | Directory to store the input '.sam' file.
sam2BAM | samOUTDIR | sam | Directory to store the output '.bam' file.
